image: debian:bullseye

stages:
  - archive
  - release

create_panorama_graph_archive:
  stage: archive
  script:
    - apt-get update && apt-get install -y zip
    - ZIP_NAME="Panorama_graph-$CI_COMMIT_TAG.zip"
    - mkdir -p dist
    - cd Panorama_graph
    - zip -r "../dist/$ZIP_NAME" . -x "*.git*" "../dist/*"
    - cd ..
  only:
    - tags
  artifacts:
    paths:
      - dist/Panorama_graph-$CI_COMMIT_TAG.zip
    expire_in: 1 week

release_graph:
  stage: release
  dependencies:
    - create_panorama_graph_archive
  script:
    - mkdir -p release
    - cp dist/Panorama_graph-$CI_COMMIT_TAG.zip release/
  only:
    - tags